import{c as $,r as i,$ as q,j as e,v as de,H as Y,a0 as ue,b as me,C as xe,f as he,a1 as fe,q as pe,D as ge,_ as B,w as je,O as ye,a2 as ve,h as j,E as H,n as G,L as N,B as y,a3 as K,a4 as Ne,t as f,a5 as U,k as we,i as Se,s as z,a6 as Ae}from"./index-CgaQgSBX.js";import{o as De,s as R,n as V,C as b,e as E,b as O,c as M,d as L,u as Ce,a as _e,L as be,F as Ee,f as w,g as S,h as A,i as D,q as C,j as _,I as Re}from"./form-UwA7P7Uy.js";import{B as ke,s as W,C as Pe,e as Fe,f as Te,d as Ie,S as k,v as P,w as F,x as T,y as I}from"./select-CFZNiKgV.js";import{M as Oe}from"./mail-Biz40D9w.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],Le=$("external-link",Me);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],J=$("refresh-cw",Ue),ze=De({base_currency:R().length(3,"Currency code must be 3 characters"),timezone:R().min(1,"Timezone is required"),locale:R().min(1,"Locale is required"),first_day_of_week:V().min(0).max(6),first_day_of_month:V().min(1).max(28),number_format:R().min(1,"Number format is required")});var Z="AlertDialog",[Ve]=me(Z,[q]),g=q(),Q=s=>{const{__scopeAlertDialog:a,...n}=s,o=g(a);return e.jsx(de,{...o,...n,modal:!0})};Q.displayName=Z;var $e="AlertDialogTrigger",qe=i.forwardRef((s,a)=>{const{__scopeAlertDialog:n,...o}=s,l=g(n);return e.jsx(ve,{...l,...o,ref:a})});qe.displayName=$e;var Ye="AlertDialogPortal",X=s=>{const{__scopeAlertDialog:a,...n}=s,o=g(a);return e.jsx(je,{...o,...n})};X.displayName=Ye;var Be="AlertDialogOverlay",ee=i.forwardRef((s,a)=>{const{__scopeAlertDialog:n,...o}=s,l=g(n);return e.jsx(ye,{...l,...o,ref:a})});ee.displayName=Be;var v="AlertDialogContent",[He,Ge]=Ve(v),Ke=fe("AlertDialogContent"),se=i.forwardRef((s,a)=>{const{__scopeAlertDialog:n,children:o,...l}=s,u=g(n),m=i.useRef(null),d=Y(a,m),p=i.useRef(null);return e.jsx(ue,{contentName:v,titleName:ae,docsSlug:"alert-dialog",children:e.jsx(He,{scope:n,cancelRef:p,children:e.jsxs(xe,{role:"alertdialog",...u,...l,ref:d,onOpenAutoFocus:he(l.onOpenAutoFocus,x=>{x.preventDefault(),p.current?.focus({preventScroll:!0})}),onPointerDownOutside:x=>x.preventDefault(),onInteractOutside:x=>x.preventDefault(),children:[e.jsx(Ke,{children:o}),e.jsx(Je,{contentRef:m})]})})})});se.displayName=v;var ae="AlertDialogTitle",te=i.forwardRef((s,a)=>{const{__scopeAlertDialog:n,...o}=s,l=g(n);return e.jsx(pe,{...l,...o,ref:a})});te.displayName=ae;var re="AlertDialogDescription",ne=i.forwardRef((s,a)=>{const{__scopeAlertDialog:n,...o}=s,l=g(n);return e.jsx(ge,{...l,...o,ref:a})});ne.displayName=re;var We="AlertDialogAction",oe=i.forwardRef((s,a)=>{const{__scopeAlertDialog:n,...o}=s,l=g(n);return e.jsx(B,{...l,...o,ref:a})});oe.displayName=We;var ie="AlertDialogCancel",le=i.forwardRef((s,a)=>{const{__scopeAlertDialog:n,...o}=s,{cancelRef:l}=Ge(ie,n),u=g(n),m=Y(a,l);return e.jsx(B,{...u,...o,ref:m})});le.displayName=ie;var Je=({contentRef:s})=>{const a=`\`${v}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${v}\` by passing a \`${re}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${v}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return i.useEffect(()=>{document.getElementById(s.current?.getAttribute("aria-describedby"))||console.warn(a)},[a,s]),null},Ze=Q,Qe=X,Xe=ee,es=se,ss=oe,as=le,ts=te,rs=ne;function ns({...s}){return e.jsx(Ze,{"data-slot":"alert-dialog",...s})}function os({...s}){return e.jsx(Qe,{"data-slot":"alert-dialog-portal",...s})}function is({className:s,...a}){return e.jsx(Xe,{"data-slot":"alert-dialog-overlay",className:j("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",s),...a})}function ls({className:s,...a}){return e.jsxs(os,{children:[e.jsx(is,{}),e.jsx(es,{"data-slot":"alert-dialog-content",className:j("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",s),...a})]})}function cs({className:s,...a}){return e.jsx("div",{"data-slot":"alert-dialog-header",className:j("flex flex-col gap-2 text-center sm:text-left",s),...a})}function ds({className:s,...a}){return e.jsx("div",{"data-slot":"alert-dialog-footer",className:j("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",s),...a})}function us({className:s,...a}){return e.jsx(ts,{"data-slot":"alert-dialog-title",className:j("text-lg font-semibold",s),...a})}function ms({className:s,...a}){return e.jsx(rs,{"data-slot":"alert-dialog-description",className:j("text-muted-foreground text-sm",s),...a})}function xs({className:s,...a}){return e.jsx(ss,{className:j(H(),s),...a})}function hs({className:s,...a}){return e.jsx(as,{className:j(H({variant:"outline"}),s),...a})}function fs(){const[s,a]=i.useState(!1),[n,o]=i.useState(!0),[l,u]=i.useState(null),[m,d]=i.useState(!1),[p,x]=i.useState(!1);i.useEffect(()=>{c()},[]);const c=async()=>{o(!0);try{const h=await G();a(h.isAuthenticated),u(h.user||null)}catch(h){console.error("Error checking Splitwise connection:",h)}finally{o(!1)}},r=async()=>{try{await Ne()}catch(h){f.error("Failed to connect",{description:h.message})}},t=async()=>{x(!0);try{const h=await W.getCurrentUser();u(h),f.success("Refreshed Splitwise data")}catch(h){h.message==="UNAUTHORIZED"?(f.error("Session expired",{description:"Please reconnect your Splitwise account"}),await U(),a(!1),u(null)):f.error("Failed to refresh",{description:h.message})}finally{x(!1)}},ce=async()=>{await U(),a(!1),u(null),d(!1),f.info("Disconnected from Splitwise")};return n?e.jsx(b,{children:e.jsx(E,{className:"p-6 flex items-center justify-center",children:e.jsx(N,{className:"h-6 w-6 animate-spin text-muted-foreground"})})}):e.jsxs(e.Fragment,{children:[e.jsxs(b,{children:[e.jsx(O,{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs(M,{className:"flex items-center gap-2",children:["Splitwise Integration",s&&e.jsx(ke,{variant:"secondary",className:"bg-green-500/10 text-green-700 dark:text-green-400",children:"Connected"})]}),e.jsx(L,{children:s?"View and track your shared expenses":"Connect to import your Splitwise expenses"})]})})}),e.jsx(E,{className:"space-y-4",children:s?e.jsxs(e.Fragment,{children:[l&&e.jsx("div",{className:"flex items-center justify-between p-4 bg-muted rounded-lg",children:e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[l.first_name," ",l.last_name]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:l.email})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{onClick:t,disabled:p,variant:"outline",size:"sm",children:p?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"mr-2 h-4 w-4 animate-spin"}),"Refreshing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"mr-2 h-4 w-4"}),"Refresh"]})}),e.jsxs(y,{onClick:()=>d(!0),variant:"outline",size:"sm",className:"text-destructive hover:text-destructive",children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),"Disconnect"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"rounded-lg border border-dashed p-4 text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Secure OAuth authentication (PKCE) — all data stays in your browser"}),e.jsxs(y,{onClick:r,className:"w-full sm:w-auto",children:[e.jsx(Le,{className:"mr-2 h-4 w-4"}),"Connect Splitwise"]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsx("p",{children:"✓ No server storage — tokens kept in your browser only"}),e.jsx("p",{children:"✓ OAuth 2.0 with PKCE for security"}),e.jsx("p",{children:"✓ Read-only access to your expenses"})]})]})})]}),e.jsx(ns,{open:m,onOpenChange:d,children:e.jsxs(ls,{children:[e.jsxs(cs,{children:[e.jsx(us,{children:"Disconnect Splitwise?"}),e.jsx(ms,{children:"This will remove your Splitwise connection and clear stored tokens. You can reconnect anytime."})]}),e.jsxs(ds,{children:[e.jsx(hs,{children:"Cancel"}),e.jsx(xs,{onClick:ce,className:"bg-destructive text-destructive-foreground",children:"Disconnect"})]})]})})]})}function ps(){const[s,a]=i.useState([]),[n,o]=i.useState(!0),[l,u]=i.useState(!1),[m,d]=i.useState(!1);i.useEffect(()=>{p()},[]);const p=async()=>{try{const c=await G();if(u(c.isAuthenticated),!c.isAuthenticated){o(!1);return}const r=await W.getRecentExpenses(20);a(r)}catch(c){c.message==="UNAUTHORIZED"?(f.error("Splitwise session expired",{description:"Please reconnect your account"}),u(!1)):f.error("Failed to load expenses",{description:c.message})}finally{o(!1)}},x=async()=>{d(!0),await p(),d(!1),f.success("Expenses refreshed")};return l?e.jsxs(b,{children:[e.jsx(O,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(M,{children:"Recent Splitwise Expenses"}),e.jsx(L,{children:"Your share of recent shared expenses"})]}),e.jsx(y,{onClick:x,disabled:m,variant:"outline",size:"sm",children:m?e.jsx(N,{className:"h-4 w-4 animate-spin"}):e.jsx(J,{className:"h-4 w-4"})})]})}),e.jsx(E,{children:n?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(N,{className:"h-8 w-8 animate-spin text-primary"})}):s.length===0?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:e.jsx("p",{children:"No recent expenses found"})}):e.jsx("div",{className:"space-y-2",children:s.map(c=>e.jsxs("div",{className:"flex items-start justify-between p-3 rounded-lg border hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[c.settled?e.jsx(Pe,{className:"h-4 w-4 text-green-600 dark:text-green-400 flex-shrink-0"}):e.jsx(Fe,{className:"h-4 w-4 text-orange-600 dark:text-orange-400 flex-shrink-0"}),e.jsx("p",{className:"font-medium truncate",children:c.description})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{children:Te(new Date(c.date),"MMM dd, yyyy")}),e.jsx("span",{children:"•"}),e.jsx("span",{children:c.group}),c.category&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsx("span",{children:c.category})]})]})]}),e.jsxs("div",{className:"text-right ml-4 flex-shrink-0",children:[e.jsx("p",{className:"font-semibold",children:Ie(c.user_share_amount,c.currency)}),c.settled&&e.jsx("p",{className:"text-xs text-green-600 dark:text-green-400",children:"Settled"})]})]},c.id))})})]}):null}const gs=[{code:"USD",name:"US Dollar"},{code:"EUR",name:"Euro"},{code:"GBP",name:"British Pound"},{code:"INR",name:"Indian Rupee"},{code:"JPY",name:"Japanese Yen"},{code:"AUD",name:"Australian Dollar"},{code:"CAD",name:"Canadian Dollar"}],js=["UTC","America/New_York","America/Chicago","America/Denver","America/Los_Angeles","Europe/London","Europe/Paris","Asia/Tokyo","Asia/Kolkata","Australia/Sydney"],ys=[{code:"en-US",name:"English (US)"},{code:"en-GB",name:"English (UK)"},{code:"en-IN",name:"English (India)"},{code:"de-DE",name:"German"},{code:"fr-FR",name:"French"},{code:"es-ES",name:"Spanish"},{code:"ja-JP",name:"Japanese"}],vs=[{value:0,name:"Sunday"},{value:1,name:"Monday"},{value:2,name:"Tuesday"},{value:3,name:"Wednesday"},{value:4,name:"Thursday"},{value:5,name:"Friday"},{value:6,name:"Saturday"}];function Ds(){const{user:s,signOut:a}=we(),n=Se(),[o,l]=i.useState(!0),[u,m]=i.useState(!1),d=Ce({resolver:_e(ze),defaultValues:{base_currency:"INR",timezone:"UTC",locale:"en-US",first_day_of_week:0,first_day_of_month:1,number_format:"en-US"}});i.useEffect(()=>{p()},[s]);const p=async()=>{if(s)try{const{data:r,error:t}=await z.from("profiles").select("*").eq("user_id",s.id).single();if(t&&t.code!=="PGRST116")throw t;r&&d.reset({base_currency:r.base_currency,timezone:r.timezone,locale:r.locale,first_day_of_week:r.first_day_of_week,first_day_of_month:r.first_day_of_month,number_format:r.number_format})}catch(r){console.error("Error loading profile:",r),f.error("Failed to load profile",{description:r.message})}finally{l(!1)}},x=async r=>{if(s){m(!0);try{const{error:t}=await z.from("profiles").upsert({user_id:s.id,...r,updated_at:new Date().toISOString()},{onConflict:"user_id"});if(t)throw t;f.success("Profile updated",{description:"Your settings have been saved"})}catch(t){console.error("Error saving profile:",t),f.error("Failed to save profile",{description:t.message})}finally{m(!1)}}},c=async()=>{await a(),n("/auth")};return o?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx(N,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-6 max-w-3xl",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Profile Settings"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your account settings and preferences"})]}),e.jsxs(b,{children:[e.jsxs(O,{children:[e.jsxs(M,{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"h-5 w-5"}),"Account Information"]}),e.jsx(L,{children:"Your account details and authentication status"})]}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-muted rounded-lg",children:[e.jsx(Oe,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(be,{className:"text-sm text-muted-foreground",children:"Email"}),e.jsx("p",{className:"font-medium",children:s?.email})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(fs,{}),e.jsx(ps,{})]}),e.jsxs(y,{onClick:c,variant:"destructive",className:"w-full sm:w-auto",children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),"Sign Out"]})]})]}),e.jsxs(b,{children:[e.jsxs(O,{children:[e.jsx(M,{children:"Preferences"}),e.jsx(L,{children:"Customize your app experience"})]}),e.jsx(E,{children:e.jsx(Ee,{...d,children:e.jsxs("form",{onSubmit:d.handleSubmit(x),className:"space-y-6",children:[e.jsx(w,{control:d.control,name:"base_currency",render:({field:r})=>e.jsxs(S,{children:[e.jsx(A,{children:"Base Currency"}),e.jsxs(k,{onValueChange:r.onChange,defaultValue:r.value,children:[e.jsx(D,{children:e.jsx(P,{children:e.jsx(F,{placeholder:"Select currency"})})}),e.jsx(T,{children:gs.map(t=>e.jsxs(I,{value:t.code,children:[t.code," -"," ",t.name]},t.code))})]}),e.jsx(C,{children:"Your primary currency for reporting"}),e.jsx(_,{})]})}),e.jsx(w,{control:d.control,name:"timezone",render:({field:r})=>e.jsxs(S,{children:[e.jsx(A,{children:"Timezone"}),e.jsxs(k,{onValueChange:r.onChange,defaultValue:r.value,children:[e.jsx(D,{children:e.jsx(P,{children:e.jsx(F,{placeholder:"Select timezone"})})}),e.jsx(T,{children:js.map(t=>e.jsx(I,{value:t,children:t},t))})]}),e.jsx(C,{children:"Used for scheduling and date display"}),e.jsx(_,{})]})}),e.jsx(w,{control:d.control,name:"locale",render:({field:r})=>e.jsxs(S,{children:[e.jsx(A,{children:"Language & Region"}),e.jsxs(k,{onValueChange:r.onChange,defaultValue:r.value,children:[e.jsx(D,{children:e.jsx(P,{children:e.jsx(F,{placeholder:"Select locale"})})}),e.jsx(T,{children:ys.map(t=>e.jsx(I,{value:t.code,children:t.name},t.code))})]}),e.jsx(C,{children:"Affects date and number formatting"}),e.jsx(_,{})]})}),e.jsx(w,{control:d.control,name:"first_day_of_week",render:({field:r})=>e.jsxs(S,{children:[e.jsx(A,{children:"First Day of Week"}),e.jsxs(k,{onValueChange:t=>r.onChange(parseInt(t)),defaultValue:r.value.toString(),children:[e.jsx(D,{children:e.jsx(P,{children:e.jsx(F,{placeholder:"Select day"})})}),e.jsx(T,{children:vs.map(t=>e.jsx(I,{value:t.value.toString(),children:t.name},t.value))})]}),e.jsx(C,{children:"Used in calendar and reports"}),e.jsx(_,{})]})}),e.jsx(w,{control:d.control,name:"first_day_of_month",render:({field:r})=>e.jsxs(S,{children:[e.jsx(A,{children:"First Day of Month"}),e.jsx(D,{children:e.jsx(Re,{type:"number",min:1,max:28,...r,onChange:t=>r.onChange(parseInt(t.target.value))})}),e.jsx(C,{children:"For monthly budget cycles (1-28)"}),e.jsx(_,{})]})}),e.jsxs(y,{type:"submit",className:"w-full sm:w-auto",disabled:u,children:[u&&e.jsx(N,{className:"mr-2 h-4 w-4 animate-spin"}),u?"Saving...":"Save Changes"]})]})})})]})]})}export{Ds as default};
